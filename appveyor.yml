version: 0.1.{build}-{branch}
branches:
  only:
    - stable
    - beta
    - nightly
    - dev
skip_tags: false
os: Windows Server 2012
init:
  - git config --global core.autocrlf input
clone_folder: c:\projects\myproject
# fetch repository as zip archive
shallow_clone: true                 # default is "false"
clone_depth: 5                      # clone entire repository history if not defined
nuget:
  account_feed: true
  project_feed: true
  disable_publish_on_pr: true     # disable publishing of .nupkg artifacts to
platform: Any CPU
#platform:
#  - x86
#  - x64
configuration:
  - Debug
  - Release
before_build:
  - nuget restore
build:
  parallel: true                  # enable MSBuild parallel builds
  project: Gerbil.sln      # path to Visual Studio solution or project
  verbosity: normal
after_test: 
    - .\packages\OpenCover.4.6.166\tools\OpenCover.Console.exe -register:user -target:"C:\projects\myproject\packages\NUnit.Runners.2.6.4\tools\nunit-console.exe" -targetargs:"C:\projects\myproject\GerbilTest\bin\%CONFIGURATION%\GerbilTest.dll /noshadow" -filter:"" -excludebyattribute:*.ExcludeFromCodeCoverage* -hideskipped:All -output:.\MyProject_coverage.xml
    - "SET PATH=C:\\Python34;C:\\Python34\\Scripts;%PATH%"
    - pip install codecov
    - codecov -f "MyProject_coverage.xml" -t "43fa8e8a-43eb-4e4c-a63e-6d4602b1263f"
#    - codecov
deploy:

    # Deploy to GitHub Releases
  - provider: GitHub
    artifact: /.*\.nupkg/           # upload all NuGet packages to release assets
    draft: true
    prerelease: false
    on:
      branch: stable                # release from master branch only
      appveyor_repo_tag: true       # deploy on tag push only
